name: Run Native Tests

on:
  push:
    branches-ignore:
      # don't run checks on changeset-release/master branch since there are only release PRs there
      - changeset-release/master

permissions:
  contents: read
  packages: read

jobs:
  android:
    runs-on: blacksmith-2vcpu-ubuntu-2204
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set Up Node.js
        uses: FigurePOS/github-actions/.github/actions/setup-node@v1

      - name: Install Dependencies
        uses: FigurePOS/github-actions/.github/actions/install-dependencies@v1

      - name: Run Android Unit Tests
        run: cd android && ./gradlew testDebugUnitTest -Pandroid.useAndroidX=true -Pandroid.enableJetifier=true
        env:
          GRADLE_OPTS: -Xmx2048m -Dorg.gradle.daemon=false # Increase heap to avoid OOM; disable daemon for CI stability

  ios:
    runs-on: macos-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set Up Node.js
        uses: FigurePOS/github-actions/.github/actions/setup-node@v1

      - name: Install Dependencies
        uses: FigurePOS/github-actions/.github/actions/install-dependencies@v1

      - name: Install xcbeautify
        run: brew install xcbeautify

      - name: Run iOS Unit Tests
        run: ./scripts/run-ios-tests.sh
